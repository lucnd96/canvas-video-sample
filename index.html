<!DOCTYPE html>
<html>
    <head>
    <title>Page Title</title>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/d3js/5.15.0/d3.min.js"></script> -->
    <script  src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="./VideoFrame.js"></script>
    </head>

    <body>

        <div id="theater">
            <video style="display: none"  id="video" src="./asset/日本語.mp4"></video>
            <canvas id="canvas"></canvas>
            <label>
            <br />Try to play me :)</label>
            <br />
            <button id="play-pause">Play</button>
        </div>
    </body>
    <script>
        var data = {
        "frames":[
        {
            "frame_no": 1,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 7,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 13,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 19,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 25,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 31,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 37,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 43,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 49,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 55,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 61,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 67,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 73,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 79,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 85,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 91,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 97,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 103,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 109,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 115,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 121,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 127,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 133,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 139,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 145,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 151,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 157,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 163,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 169,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {
                "0": {
                    "tracking": 0,
                    "x1": 73,
                    "y1": 108,
                    "x2": 112,
                    "y2": 160,
                    "poster": 0,
                    "face_list": [
                        {
                            "face_id": 10002,
                            "score": 0.885193943977356,
                            "name": "�����G��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\010002_�����G��\\Face0000_����.png"
                        },
                        {
                            "face_id": 9,
                            "score": 0.17652499675750732,
                            "name": "�ؖ삳��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000009_�ؖ삳��\\Face0000_�ؖ�.png"
                        },
                        {
                            "face_id": 4,
                            "score": 0.1320813000202179,
                            "name": "�W���u�X",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000004_�W���u�X\\Face0000_downloaad.png"
                        },
                        {
                            "face_id": 7,
                            "score": 0.09722349047660828,
                            "name": "�q�эF�v",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000007_�q�эF�v\\Face0000_�q�юЈ���.png"
                        },
                        {
                            "face_id": 14,
                            "score": 0.06368808448314667,
                            "name": "�v�[�`��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000014_�v�[�`��\\Face0000_�v�[�`���Q.png"
                        }
                    ]
                }
            }
        },
        {
            "frame_no": 175,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {
                "0": {
                    "tracking": 0,
                    "x1": 73,
                    "y1": 126,
                    "x2": 113,
                    "y2": 182,
                    "poster": 0,
                    "face_list": [
                        {
                            "face_id": 10002,
                            "score": 0.8982292413711548,
                            "name": "�����G��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\010002_�����G��\\Face0000_����.png"
                        },
                        {
                            "face_id": 9,
                            "score": 0.1641586720943451,
                            "name": "�ؖ삳��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000009_�ؖ삳��\\Face0000_�ؖ�.png"
                        },
                        {
                            "face_id": 4,
                            "score": 0.13483761250972748,
                            "name": "�W���u�X",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000004_�W���u�X\\Face0000_downloaad.png"
                        },
                        {
                            "face_id": 7,
                            "score": 0.12934067845344543,
                            "name": "�q�эF�v",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000007_�q�эF�v\\Face0000_�q�юЈ���.png"
                        },
                        {
                            "face_id": 14,
                            "score": 0.04849974066019058,
                            "name": "�v�[�`��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000014_�v�[�`��\\Face0000_�v�[�`��.png"
                        }
                    ]
                }
            }
        },
        {
            "frame_no": 181,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {
                "0": {
                    "tracking": 0,
                    "x1": 73,
                    "y1": 127,
                    "x2": 113,
                    "y2": 182,
                    "poster": 0,
                    "face_list": [
                        {
                            "face_id": 10002,
                            "score": 0.9095437526702881,
                            "name": "�����G��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\010002_�����G��\\Face0000_����.png"
                        },
                        {
                            "face_id": 9,
                            "score": 0.15978580713272095,
                            "name": "�ؖ삳��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000009_�ؖ삳��\\Face0000_�ؖ�.png"
                        },
                        {
                            "face_id": 4,
                            "score": 0.13138453662395477,
                            "name": "�W���u�X",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000004_�W���u�X\\Face0000_downloaad.png"
                        },
                        {
                            "face_id": 7,
                            "score": 0.10770286619663239,
                            "name": "�q�эF�v",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000007_�q�эF�v\\Face0000_�q�юЈ���.png"
                        },
                        {
                            "face_id": 10004,
                            "score": 0.03937847167253494,
                            "name": "���ׂ���",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\010004_���ׂ���\\Face0000_���׏r�q.png"
                        }
                    ]
                }
            }
        },
        {
            "frame_no": 187,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {
                "0": {
                    "tracking": 0,
                    "x1": 73,
                    "y1": 132,
                    "x2": 113,
                    "y2": 183,
                    "poster": 0,
                    "face_list": [
                        {
                            "face_id": 10002,
                            "score": 0.9253721237182617,
                            "name": "�����G��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\010002_�����G��\\Face0000_����.png"
                        },
                        {
                            "face_id": 9,
                            "score": 0.1652592122554779,
                            "name": "�ؖ삳��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000009_�ؖ삳��\\Face0000_�ؖ�.png"
                        },
                        {
                            "face_id": 4,
                            "score": 0.13010403513908386,
                            "name": "�W���u�X",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000004_�W���u�X\\Face0000_downloaad.png"
                        },
                        {
                            "face_id": 7,
                            "score": 0.11869562417268753,
                            "name": "�q�эF�v",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000007_�q�эF�v\\Face0000_�q�юЈ���.png"
                        },
                        {
                            "face_id": 10004,
                            "score": 0.04084433987736702,
                            "name": "���ׂ���",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\010004_���ׂ���\\Face0000_���׏r�q.png"
                        }
                    ]
                }
            }
        },
        {
            "frame_no": 193,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {
                "0": {
                    "tracking": 0,
                    "x1": 73,
                    "y1": 126,
                    "x2": 113,
                    "y2": 180,
                    "poster": 0,
                    "face_list": [
                        {
                            "face_id": 10002,
                            "score": 0.9116289615631104,
                            "name": "�����G��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\010002_�����G��\\Face0000_����.png"
                        },
                        {
                            "face_id": 9,
                            "score": 0.13853950798511505,
                            "name": "�ؖ삳��",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000009_�ؖ삳��\\Face0000_�ؖ�.png"
                        },
                        {
                            "face_id": 7,
                            "score": 0.12159008532762527,
                            "name": "�q�эF�v",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000007_�q�эF�v\\Face0000_�q�юЈ���.png"
                        },
                        {
                            "face_id": 4,
                            "score": 0.11638296395540237,
                            "name": "�W���u�X",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\000004_�W���u�X\\Face0000_downloaad.png"
                        },
                        {
                            "face_id": 10004,
                            "score": 0.04468924552202225,
                            "name": "���ׂ���",
                            "poster": 0,
                            "image_path": "\\\\10.45.52.78\\facedic\\fd000001\\010004_���ׂ���\\Face0000_���׏r�q.png"
                        }
                    ]
                }
            }
        },
        {
            "frame_no": 199,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 205,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 211,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 217,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 223,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 229,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 235,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 241,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 247,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 253,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 259,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 265,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 271,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 277,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 283,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        },
        {
            "frame_no": 289,
            "src": "\\\\10.45.52.78\\upload\\���{��.mp4",
            "rects": {}
        }
    ]
        }
        var videoFrame = 0;
        var video = VideoFrame({
            id : 'video',
            frameRate: 30,
            callback : function(frame) {
                videoFrame = frame;
            }
        });

        document.getElementById('play-pause').addEventListener('click', function(e){
            if(video.video.paused){
                video.video.play();
                video.listen('frame');
                e.target.innerHTML = 'Pause';
            }else{
                video.video.pause();
                video.stopListen();
                e.target.innerHTML = 'Play';
            }
        });

        $(function() {
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            var video = document.getElementById('video');
            var currentFrame = 0;
            video.addEventListener('play', function() {
                var $this = this; //cache
                let rects;
                (function loop() {
                if (!$this.paused && !$this.ended) {
                    ctx.drawImage($this, 0, 0);
                    for (let i = currentFrame; i < data.frames.length ; i++){
                        if(data.frames[i].frame_no === videoFrame && data.frames[i].rects['0']){
                            currentFrame = i;
                            rects = data.frames[i].rects['0'];
                            break;
                        } else if (data.frames[i].frame_no === videoFrame && !data.frames[i].rects['0']){
                            rects = null;
                            break;
                        }
                        else if(data.frames[i].frame_no > videoFrame) {
                            break;
                        }
                    }
                    if (rects){
                        ctx.beginPath();
                        ctx.lineWidth = "2";
                        ctx.strokeStyle = "red";
                        ctx.rect(rects.x1, rects.y1, rects.x1 - rects.x2, rects.y1 - rects.y2);
                        ctx.stroke();
                    }
                    setTimeout(loop, 1000 / 30); // drawing at 30fps
                }
                })();
            }, 0);
            });
    </script>
</html>